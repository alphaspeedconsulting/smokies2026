#!/usr/bin/env node

/**
 * Generate env-config.js from .env file
 * This script reads .env and creates env-config.js for browser use
 * 
 * Usage: node generate-env-config.js
 */

const fs = require('fs');
const path = require('path');

const envPath = path.join(__dirname, '.env');
const outputPath = path.join(__dirname, 'env-config.js');

// Read .env file
if (!fs.existsSync(envPath)) {
    console.error('Error: .env file not found!');
    console.error('Please create a .env file with:');
    console.error('  AIRTABLE_PAT=your_token_here');
    console.error('  AIRTABLE_BASE_ID=your_base_id_here');
    process.exit(1);
}

const envContent = fs.readFileSync(envPath, 'utf8');
const envVars = {};

// Parse .env file (simple parser - handles KEY=VALUE format)
envContent.split('\n').forEach(line => {
    line = line.trim();
    // Skip empty lines and comments
    if (!line || line.startsWith('#')) return;
    
    const match = line.match(/^([^=]+)=(.*)$/);
    if (match) {
        const key = match[1].trim();
        let value = match[2].trim();
        
        // Remove quotes if present
        if ((value.startsWith('"') && value.endsWith('"')) || 
            (value.startsWith("'") && value.endsWith("'"))) {
            value = value.slice(1, -1);
        }
        
        envVars[key] = value;
    }
});

// Validate required variables
if (!envVars.AIRTABLE_PAT) {
    console.error('Error: AIRTABLE_PAT not found in .env file');
    process.exit(1);
}

if (!envVars.AIRTABLE_BASE_ID) {
    console.error('Error: AIRTABLE_BASE_ID not found in .env file');
    process.exit(1);
}

// Generate env-config.js
const configContent = `// Load environment variables from .env file
// This file is automatically generated by generate-env-config.js
// DO NOT EDIT THIS FILE MANUALLY - it will be overwritten
window.ENV = {
    AIRTABLE_PAT: '${envVars.AIRTABLE_PAT}',
    AIRTABLE_BASE_ID: '${envVars.AIRTABLE_BASE_ID}'
};
`;

// Write output file
fs.writeFileSync(outputPath, configContent, 'utf8');
console.log('âœ… Successfully generated env-config.js from .env file');
console.log(`   Output: ${outputPath}`);
